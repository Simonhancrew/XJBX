# 什么是一个线程？

## Pthreads概述：什么是一个线程

从技术层面上讲，线程可以被定义为一个独立的操作流程，可以有操作系统调度运行。但是，这到底怎么解释呢？

对于软件开发者，对于线程最好的描述就是，独立于主程序去运行的一个程序。

更深层的去理解这个概念，假设一个主程序，包含多条流程。然后想象每一个流程能够被操作系统调度成同时且/或独立的运行。这就是一个多线程程序的描述。

这个过程是如何实现的呢？

在理解一个线程之前，我们首先需要去理解一个UNIX进程。进程是由操作系统创建，并且他是需要一些额外的开销的。进程包含着程序程序资源和程序执行状态的信息。这些信息包括：

+ 进程ID，进程组ID,用户ID和组ID
+ 上下文环境
+ 工作目录
+ 程序说明
+ 寄存器
+ 栈
+ 堆
+ 文件描述符（fd）
+ 信号量
+ 共享库文件
+ 进程间通信工具（消息队列，管道，信号，共享内存）

线程利用并存在于这些进程资源中，然而，他们能够被操作系统调度并作为独立的实体运行，主要是因为他们只复制能够使他们作为可执行代码存在的基本资源。

这种独立的控制流的实现，是因为线程自己维护了自己的：

+ 栈指针
+ 寄存器
+ 调度资源
+ 一组挂起和阻塞的信号
+ 线程的特有信息

所以 ，总结一下，在unix环境中，一个线程：

+ 存在于一个进程中，并利用进程的资源
+ 拥有自己的独立控制流，只要他的父进程存在，且操作系统支持她
+ 今复置调度必须的基本资源
+ 可以与其他独立运行的线程共享进程资源
+ 父进程死亡，线程也会结束
+ 是轻量级的，因为大部分的开销是创建进程完成的

因为用一个进程空间的线程是共享资源的：

+ 一个线程堆共享的资源做的修改是可以被其他线程看到的
+ 两个指针又一样的值会指向同样的数据
+ 读取和写入相同的内存位置是可能的，因此需要程序员考虑同步的问题

